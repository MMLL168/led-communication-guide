<!DOCTYPE html> <html lang="zh-TW"> <head>     <meta charset="UTF-8">     <meta name="viewport" content="width=device-width, initial-scale=1.0">     <title>RPi 5 LED Matrix | 工程實作指南 v5.2</title>          <!-- Libraries -->     <script src="https://cdn.tailwindcss.com"></script>     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark-reasonable.min.css">     <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>     <script>hljs.highlightAll();</script>          <!-- Fonts -->     <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">      <style>         body {              font-family: 'Noto Sans TC', sans-serif;              background-color: #0f172a; /* Slate 900 */             color: #e2e8f0; /* Slate 200 */         }         h1, h2, h3 { color: #f8fafc; font-weight: 700; letter-spacing: -0.025em; }         code { font-family: 'JetBrains Mono', monospace; }                  /* Sidebar Navigation */         .nav-item {             display: block; padding: 0.75rem 1rem; margin-bottom: 0.25rem; border-radius: 0.375rem;             color: #94a3b8; transition: all 0.2s; cursor: pointer;         }         .nav-item:hover, .nav-item.active { background-color: #1e293b; color: #38bdf8; border-left: 3px solid #38bdf8; }                  /* Schematic SVG Styles */         .chip { fill: #1e293b; stroke: #cbd5e1; stroke-width: 2; }         .pin-label { font-size: 10px; font-family: 'JetBrains Mono', monospace; fill: #94a3b8; }         .wire { stroke: #64748b; stroke-width: 1.5; fill: none; stroke-linecap: round; }         .wire.pwr { stroke: #ef4444; }          .wire.gnd { stroke: #3b82f6; }         .junction { fill: #cbd5e1; }          /* Tables */         .tech-table { width: 100%; border-collapse: collapse; font-size: 0.875rem; }         .tech-table th { text-align: left; padding: 0.75rem; background-color: #1e293b; color: #94a3b8; border-bottom: 1px solid #334155; font-family: 'JetBrains Mono'; }         .tech-table td { padding: 0.75rem; border-bottom: 1px solid #334155; }         .tech-table tr:hover { background-color: #1e293b; }                  /* Utility */         .badge { display: inline-block; padding: 0.125rem 0.375rem; font-size: 0.75rem; font-weight: 700; border-radius: 0.25rem; font-family: 'JetBrains Mono'; }         .badge-warn { background-color: #7f1d1d; color: #fca5a5; }         .badge-info { background-color: #1e3a8a; color: #93c5fd; }     </style> </head> <body class="flex h-screen overflow-hidden">      <!-- Sidebar -->     <aside class="w-64 bg-slate-950 border-r border-slate-800 flex flex-col hidden md:flex">         <div class="p-6">             <h1 class="text-xl text-white flex items-center gap-2">                 <span class="text-sky-500">⚡</span> RPi 5 Matrix             </h1>             <p class="text-xs text-slate-500 mt-1">Direct Drive Implementation</p>         </div>          <!-- ADDED: Back to Theory Guide Button -->         <div class="px-4 pb-6">             <a href="index.html" class="flex items-center justify-center w-full px-4 py-2 text-sm font-bold text-slate-300 bg-slate-900 border border-slate-700 rounded hover:bg-slate-800 hover:text-white hover:border-slate-600 transition group">                 <svg class="w-4 h-4 mr-2 group-hover:-translate-x-1 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>                 Back to Theory             </a>         </div>          <nav class="flex-1 px-4 overflow-y-auto">             <a onclick="scrollToSection('bom')" class="nav-item active">1. 硬體 BOM 表</a>             <a onclick="scrollToSection('schematic')" class="nav-item">2. 電路原理圖</a>             <a onclick="scrollToSection('pinout')" class="nav-item">3. Pinout 定義</a>             <a onclick="scrollToSection('wiring')" class="nav-item">4. 物理佈線</a>             <a onclick="scrollToSection('firmware')" class="nav-item">5. 韌體程式碼</a>             <a onclick="scrollToSection('checklist')" class="nav-item">6. 工程師檢核</a>         </nav>         <div class="p-4 border-t border-slate-800 text-xs text-slate-600">             v5.2 Implementation<br>For Marlon         </div>     </aside>      <!-- Main Content -->     <main class="flex-1 overflow-y-auto scroll-smooth">         <div class="max-w-5xl mx-auto p-8">                          <!-- Mobile Back Button (Visible only on small screens) -->             <div class="md:hidden mb-6">                 <a href="index.html" class="inline-flex items-center text-sky-400 hover:text-white">                     <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>                     Back to Guide                 </a>             </div>              <!-- Header -->             <div class="mb-12 border-b border-slate-800 pb-8">                 <h2 class="text-3xl text-white mb-4">Raspberry Pi 5 All-in-One 直驅實作指南</h2>                 <p class="text-slate-400 leading-relaxed">                     本文件旨在指導工程師如何繞過傳統的發送卡/接收卡架構，直接利用 RPi 5 的 GPIO 與 SMI/DPI 介面驅動 HUB75 LED 矩陣。                     <br>核心技術棧：<code class="text-sky-400">rpi-rgb-led-matrix</code> + <code class="text-sky-400">74AHCT245 Active HAT</code>。                 </p>             </div>              <!-- 1. BOM -->             <section id="bom" class="mb-16">                 <h3 class="text-xl text-sky-400 mb-6 flex items-center gap-2">                     <span class="text-2xl">01.</span> 硬體 BOM 表 (Bill of Materials)                 </h3>                 <div class="bg-slate-900 rounded-lg border border-slate-800 overflow-hidden">                     <table class="tech-table">                         <thead>                             <tr>                                 <th class="w-1/4">Component</th>                                 <th class="w-1/4">Specification</th>                                 <th class="w-1/2">Engineering Notes</th>                             </tr>                         </thead>                         <tbody>                             <tr>                                 <td class="font-bold text-white">Raspberry Pi 5</td>                                 <td>4GB Model</td>                                 <td>                                     <span class="badge badge-info">RECOMMENDED</span><br>                                     4GB 可避免 GUI 運作時發生 Swap 導致畫面閃爍 (Glitch)。                                 </td>                             </tr>                             <tr>                                 <td class="font-bold text-white">Logic Buffer</td>                                 <td>74AHCT245</td>                                 <td>                                     <span class="badge badge-warn">CRITICAL</span><br>                                     必須使用 AHCT (TTL-compatible)。RPi 3.3V 邏輯需升壓至 5V 才能穩定驅動面板。                                 </td>                             </tr>                             <tr>                                 <td class="font-bold text-white">Power Supply</td>                                 <td>5V 40A (200W)</td>                                 <td>                                     假設驅動 6 片 P3 面板。務必與 RPi <strong>共地 (Common Ground)</strong>。                                 </td>                             </tr>                             <tr>                                 <td class="font-bold text-white">Capacitors</td>                                 <td>1000uF & 0.1uF</td>                                 <td>                                     1000uF 接電源輸入端 (Bulk)；0.1uF 接每顆 IC VCC 旁 (Decoupling)。                                 </td>                             </tr>                         </tbody>                     </table>                 </div>             </section>              <!-- 2. Schematic -->             <section id="schematic" class="mb-16">                 <h3 class="text-xl text-sky-400 mb-6 flex items-center gap-2">                     <span class="text-2xl">02.</span> Active HAT 電路原理圖                 </h3>                 <div class="bg-white rounded-lg p-4 overflow-x-auto shadow-xl">                     <!-- SVG Schematic -->                     <svg width="800" height="450" viewBox="0 0 800 450">                         <!-- Background Grid -->                         <defs>                             <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">                                 <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#f1f5f9" stroke-width="1"/>                             </pattern>                         </defs>                         <rect width="100%" height="100%" fill="url(#grid)" />                          <!-- Components -->                         <!-- RPi Header -->                         <g transform="translate(50, 50)">                             <rect width="80" height="350" class="chip" />                             <text x="40" y="-10" text-anchor="middle" font-weight="bold" fill="#334155">RPi GPIO</text>                             <text x="10" y="30" class="pin-label">3.3V</text>                             <text x="10" y="50" class="pin-label">GND</text>                             <text x="10" y="80" class="pin-label">GPIO 5 (R1)</text>                             <text x="10" y="100" class="pin-label">GPIO 13 (G1)</text>                             <text x="10" y="300" class="pin-label">GPIO 17 (CLK)</text>                         </g>                          <!-- Buffer U1 -->                         <g transform="translate(300, 50)">                             <rect width="100" height="150" class="chip" />                             <text x="50" y="-10" text-anchor="middle" font-weight="bold" fill="#334155">74AHCT245 (RGB)</text>                             <text x="10" y="30" class="pin-label">DIR -> VCC</text>                             <text x="10" y="50" class="pin-label">OE -> GND</text>                             <text x="50" y="170" text-anchor="middle" font-size="10" fill="#64748b">Level Shifter</text>                         </g>                          <!-- Buffer U2 -->                         <g transform="translate(300, 250)">                             <rect width="100" height="150" class="chip" />                             <text x="50" y="-10" text-anchor="middle" font-weight="bold" fill="#334155">74AHCT245 (Ctrl)</text>                         </g>                          <!-- HUB75 -->                         <g transform="translate(600, 100)">                             <rect width="80" height="250" class="chip" />                             <text x="40" y="-10" text-anchor="middle" font-weight="bold" fill="#334155">HUB75 OUT</text>                             <text x="60" y="30" class="pin-label">R1 (Pin 1)</text>                             <text x="60" y="50" class="pin-label">G1 (Pin 2)</text>                             <text x="60" y="200" class="pin-label">CLK (Pin 13)</text>                         </g>                          <!-- Wires (simplified) -->                         <!-- 3.3V to Input -->                         <line x1="130" y1="80" x2="300" y2="80" class="wire" />                         <line x1="130" y1="100" x2="300" y2="100" class="wire" />                         <line x1="130" y1="300" x2="300" y2="300" class="wire" /> <!-- CLK -->                          <!-- 5V to Output -->                         <line x1="400" y1="80" x2="600" y2="130" class="wire" />                         <line x1="400" y1="100" x2="600" y2="150" class="wire" />                         <line x1="400" y1="300" x2="600" y2="300" class="wire" /> <!-- CLK -->                          <!-- Power Rails -->                         <line x1="350" y1="50" x2="350" y2="20" class="wire pwr" stroke-width="3" />                         <text x="355" y="15" font-size="12" fill="#ef4444" font-weight="bold">5V Source</text>                                                  <line x1="350" y1="200" x2="350" y2="250" class="wire gnd" stroke-width="3" />                         <line x1="350" y1="400" x2="350" y2="430" class="wire gnd" stroke-width="3" />                         <text x="355" y="445" font-size="12" fill="#3b82f6" font-weight="bold">GND (Common)</text>                      </svg>                 </div>                 <p class="text-sm text-slate-500 mt-2 text-center">* 建議使用 3 顆 74AHCT245 分別處理 RGB1、RGB2 與 Control 訊號以減少干擾。</p>             </section>              <!-- 3. Pinout -->             <section id="pinout" class="mb-16">                 <h3 class="text-xl text-sky-400 mb-6 flex items-center gap-2">                     <span class="text-2xl">03.</span> Pinout 定義 (Adafruit / Hzeller Standard)                 </h3>                 <div class="grid grid-cols-1 md:grid-cols-2 gap-8">                     <div class="bg-slate-900 rounded-lg border border-slate-800 p-4">                         <h4 class="text-white font-bold mb-4 border-b border-slate-700 pb-2">DATA PINS (RGB)</h4>                         <table class="tech-table">                             <thead><tr><th>Signal</th><th>RPi GPIO</th><th>Pin #</th></tr></thead>                             <tbody>                                 <tr><td><span class="text-red-400">R1</span></td><td>GPIO 5</td><td>29</td></tr>                                 <tr><td><span class="text-green-400">G1</span></td><td>GPIO 13</td><td>33</td></tr>                                 <tr><td><span class="text-blue-400">B1</span></td><td>GPIO 6</td><td>31</td></tr>                                 <tr><td><span class="text-red-400">R2</span></td><td>GPIO 12</td><td>32</td></tr>                                 <tr><td><span class="text-green-400">G2</span></td><td>GPIO 16</td><td>36</td></tr>                                 <tr><td><span class="text-blue-400">B2</span></td><td>GPIO 23</td><td>16</td></tr>                             </tbody>                         </table>                     </div>                     <div class="bg-slate-900 rounded-lg border border-slate-800 p-4">                         <h4 class="text-white font-bold mb-4 border-b border-slate-700 pb-2">CONTROL PINS</h4>                         <table class="tech-table">                             <thead><tr><th>Signal</th><th>RPi GPIO</th><th>Pin #</th></tr></thead>                             <tbody>                                 <tr><td><span class="text-yellow-400">CLK</span></td><td>GPIO 17</td><td>11</td></tr>                                 <tr><td><span class="text-yellow-400">LAT</span></td><td>GPIO 4</td><td>7</td></tr>                                 <tr><td><span class="text-yellow-400">OE</span></td><td>GPIO 18</td><td>12</td></tr>                                 <tr><td>A</td><td>GPIO 22</td><td>15</td></tr>                                 <tr><td>B</td><td>GPIO 26</td><td>37</td></tr>                                 <tr><td>C</td><td>GPIO 27</td><td>13</td></tr>                                 <tr><td>D</td><td>GPIO 20</td><td>38</td></tr>                                 <tr><td>E</td><td>GPIO 21</td><td>40</td></tr>                             </tbody>                         </table>                     </div>                 </div>             </section>              <!-- 4. Wiring -->             <section id="wiring" class="mb-16">                 <h3 class="text-xl text-sky-400 mb-6 flex items-center gap-2">                     <span class="text-2xl">04.</span> 物理佈線策略 (Cabling)                 </h3>                 <div class="grid grid-cols-1 md:grid-cols-2 gap-6">                     <div class="bg-slate-800 p-6 rounded-xl border border-slate-700">                         <h4 class="text-lg font-bold text-amber-400 mb-2">數據線：U 型菊花鏈</h4>                         <p class="text-sm text-slate-400 mb-4">節省排線長度，需在軟體設定 U-Mapper。</p>                         <div class="font-mono text-xs text-slate-300 bg-black p-4 rounded leading-loose">                             [ RPi ]<br>                               |<br>                               v<br>                             [Panel 1] --> [Panel 2] --> [Panel 3]<br>                                                             |<br>                                                             v<br>                             [Panel 6] <-- [Panel 5] <-- [Panel 4]                         </div>                     </div>                     <div class="bg-slate-800 p-6 rounded-xl border border-slate-700">                         <h4 class="text-lg font-bold text-red-400 mb-2">電源線：星狀並聯</h4>                         <p class="text-sm text-slate-400 mb-4">嚴禁串聯供電！請使用 VCC Bus Bar。</p>                         <div class="font-mono text-xs text-slate-300 bg-black p-4 rounded leading-loose">                                      [ PSU 5V 40A ]<br>                                     /      |      \<br>                             [Panel 1]  [Panel 2]  [Panel 3] ...<br>                                     \      |      /<br>                                      [ RPi GND ] (共地)                         </div>                     </div>                 </div>             </section>              <!-- 5. Firmware Code -->             <section id="firmware" class="mb-16">                 <h3 class="text-xl text-sky-400 mb-6 flex items-center gap-2">                     <span class="text-2xl">05.</span> 韌體程式碼 (Python)                 </h3>                 <p class="mb-4 text-slate-400">使用 <code>rpi-rgb-led-matrix</code>。此腳本包含 U 型映射與 RPi 5 速度優化設定。</p>                 <div class="relative">                     <div class="absolute top-0 right-0 bg-slate-700 text-xs px-2 py-1 text-slate-300 rounded-bl-lg">matrix_driver.py</div>                     <pre><code class="language-python rounded-lg shadow-lg text-sm">#!/usr/bin/env python from rgbmatrix import RGBMatrix, RGBMatrixOptions import time import sys  def run_matrix():     # 1. 硬體參數 (Hardware Config)     options = RGBMatrixOptions()     options.rows = 64     options.cols = 64     options.chain_length = 6      # 總面板數 (3x2)     options.parallel = 1     options.hardware_mapping = 'regular'  # Adafruit HAT          # 2. RPi 5 關鍵優化 (Critical for RPi 5)     # 降低 GPIO 翻轉速度以配合 Buffer IC (2~5)     options.gpio_slowdown = 4           # 3. 像素映射 (Pixel Mapper)     # "U-mapper" 處理 S 型走線，每 3 片折返一次     options.pixel_mapper_config = "U-mapper;3"      try:         matrix = RGBMatrix(options=options)         print(f"Matrix Init Success: {matrix.width}x{matrix.height}")     except Exception as e:         print(f"Error: {e}")         sys.exit(1)      # 4. 測試圖樣：移動方塊     offset_x = 0     try:         print("Running... Press CTRL-C to stop.")         while True:             canvas = matrix.CreateFrameCanvas()                          # 畫邊框             for x in range(matrix.width):                 canvas.SetPixel(x, 0, 255, 0, 0)                 canvas.SetPixel(x, matrix.height-1, 255, 0, 0)                          # 畫移動內容             pos_x = offset_x % matrix.width             for y in range(10, 50):                 for x in range(pos_x, pos_x + 20):                     if x < matrix.width:                         canvas.SetPixel(x, y, 0, 100, 255)              canvas = matrix.SwapOnVSync(canvas)             offset_x += 1                          # 控制 FPS             # RPi 5 效能過剩，適當 sleep 降低 CPU 負載             time.sleep(0.01)       except KeyboardInterrupt:         sys.exit(0)  if __name__ == "__main__":     run_matrix()</code></pre>                 </div>             </section>              <!-- 6. Checklist -->             <section id="checklist" class="mb-16">                 <h3 class="text-xl text-sky-400 mb-6 flex items-center gap-2">                     <span class="text-2xl">06.</span> 工程師檢核表 (Troubleshooting)                 </h3>                 <div class="bg-slate-900 border border-slate-800 rounded-lg p-6 space-y-4">                     <div class="flex items-start gap-4">                         <div class="text-red-500 text-xl">⚠️</div>                         <div>                             <h4 class="text-white font-bold">畫面閃爍 / 鬼影 (Ghosting)</h4>                             <p class="text-sm text-slate-400">原因：GPIO 速度太快或 GND 接地不良。<br>解法：增加 <code>gpio_slowdown</code> 參數，檢查共地。</p>                         </div>                     </div>                     <div class="flex items-start gap-4">                         <div class="text-amber-500 text-xl">⚠️</div>                         <div>                             <h4 class="text-white font-bold">畫面錯位 / 亂碼</h4>                             <p class="text-sm text-slate-400">原因：映射邏輯錯誤。<br>解法：檢查 <code>pixel_mapper_config</code> 是否匹配物理走線。</p>                         </div>                     </div>                     <div class="flex items-start gap-4">                         <div class="text-blue-500 text-xl">ℹ️</div>                         <div>                             <h4 class="text-white font-bold">音效干擾</h4>                             <p class="text-sm text-slate-400">RPi 的 onboard audio 使用 PWM (GPIO 18)，會與 LED 衝突。<br>解法：在 <code>/boot/config.txt</code> 中設定 <code>dtparam=audio=off</code>。</p>                         </div>                     </div>                 </div>             </section>          </div>     </main>      <script>         function scrollToSection(id) {             document.getElementById(id).scrollIntoView({ behavior: 'smooth' });                          // Update active state             document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));             const activeNav = document.querySelector(`.nav-item[onclick*="${id}"]`);             if(activeNav) activeNav.classList.add('active');         }     </script> </body> </html> 
