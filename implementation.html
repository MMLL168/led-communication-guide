<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPi 5 LED Matrix | 工程實作指南 v5.3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark-reasonable.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #0f172a; color: #e2e8f0; }
        h1, h2, h3 { color: #f8fafc; font-weight: 700; }
        code { font-family: 'JetBrains Mono', monospace; }
        .nav-item { display: block; padding: 0.75rem 1rem; margin-bottom: 0.25rem; border-radius: 0.375rem; color: #94a3b8; transition: all 0.2s; cursor: pointer; }
        .nav-item:hover, .nav-item.active { background-color: #1e293b; color: #38bdf8; border-left: 3px solid #38bdf8; }
        .chip { fill: #1e293b; stroke: #cbd5e1; stroke-width: 2; }
        .pin-label { font-size: 10px; font-family: 'JetBrains Mono', monospace; fill: #94a3b8; }
        .wire { stroke: #64748b; stroke-width: 1.5; fill: none; stroke-linecap: round; }
        .tech-table { width: 100%; border-collapse: collapse; font-size: 0.875rem; }
        .tech-table th { text-align: left; padding: 0.75rem; background-color: #1e293b; color: #94a3b8; border-bottom: 1px solid #334155; font-family: 'JetBrains Mono'; }
        .tech-table td { padding: 0.75rem; border-bottom: 1px solid #334155; }
        .tech-table tr:hover { background-color: #1e293b; }
        .badge { display: inline-block; padding: 0.125rem 0.375rem; font-size: 0.75rem; font-weight: 700; border-radius: 0.25rem; font-family: 'JetBrains Mono'; }
        .badge-warn { background-color: #7f1d1d; color: #fca5a5; }
        .badge-info { background-color: #1e3a8a; color: #93c5fd; }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <aside class="w-64 bg-slate-950 border-r border-slate-800 flex flex-col hidden md:flex">
        <div class="p-6">
            <h1 class="text-xl text-white flex items-center gap-2"><span class="text-sky-500">⚡</span> RPi 5 Matrix</h1>
            <p class="text-xs text-slate-500 mt-1">Direct Drive Implementation</p>
        </div>
        <div class="px-4 pb-6">
            <a href="index.html" class="flex items-center justify-center w-full px-4 py-2 text-sm font-bold text-slate-300 bg-slate-900 border border-slate-700 rounded hover:bg-slate-800 hover:text-white hover:border-slate-600 transition group">
                <svg class="w-4 h-4 mr-2 group-hover:-translate-x-1 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                Back to Theory
            </a>
        </div>
        <nav class="flex-1 px-4 overflow-y-auto">
            <a onclick="scrollToSection('bom')" class="nav-item active">1. 硬體 BOM 表</a>
            <a onclick="scrollToSection('schematic')" class="nav-item">2. 電路原理圖 (Fixed)</a>
            <a onclick="scrollToSection('pinout')" class="nav-item">3. Pinout 定義</a>
            <a onclick="scrollToSection('wiring')" class="nav-item">4. 物理佈線</a>
            <a onclick="scrollToSection('firmware')" class="nav-item">5. 韌體程式碼</a>
            <a onclick="scrollToSection('checklist')" class="nav-item">6. 工程師檢核</a>
        </nav>
    </aside>

    <main class="flex-1 overflow-y-auto scroll-smooth">
        <div class="max-w-5xl mx-auto p-8">
            <!-- Header -->
            <div class="mb-12 border-b border-slate-800 pb-8">
                <h2 class="text-3xl text-white mb-4">RPi 5 All-in-One 直驅實作指南</h2>
                <p class="text-slate-400">核心技術棧：<code class="text-sky-400">rpi-rgb-led-matrix</code> + <code class="text-sky-400">3x 74AHCT245</code>。</p>
            </div>

            <!-- 1. BOM -->
            <section id="bom" class="mb-16">
                <h3 class="text-xl text-sky-400 mb-6 flex items-center gap-2"><span class="text-2xl">01.</span> 硬體 BOM 表</h3>
                <div class="bg-slate-900 rounded-lg border border-slate-800 overflow-hidden">
                    <table class="tech-table">
                        <thead><tr><th>Component</th><th>Spec</th><th>Notes</th></tr></thead>
                        <tbody>
                            <tr><td class="font-bold text-white">Raspberry Pi 5</td><td>4GB</td><td>避免 GUI Swap 造成閃爍。</td></tr>
                            <tr><td class="font-bold text-white">Logic Buffer</td><td>3x 74AHCT245</td><td><span class="badge badge-warn">AHCT ONLY</span> 3.3V 轉 5V TTL。</td></tr>
                            <tr><td class="font-bold text-white">Power Supply</td><td>5V 40A</td><td>與 RPi 共地。</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- 2. Schematic (REFACTORED) -->
            <section id="schematic" class="mb-16">
                <h3 class="text-xl text-sky-400 mb-6 flex items-center gap-2"><span class="text-2xl">02.</span> Active HAT 電路原理圖 (3-Chip Design)</h3>
                <div class="bg-white rounded-lg p-4 overflow-x-auto shadow-xl">
                    <svg width="850" height="500" viewBox="0 0 850 500">
                        <defs><pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse"><path d="M 20 0 L 0 0 0 20" fill="none" stroke="#f1f5f9" stroke-width="1"/></pattern></defs>
                        <rect width="100%" height="100%" fill="url(#grid)" />

                        <!-- RPi Header -->
                        <g transform="translate(50, 50)">
                            <rect width="100" height="400" class="chip" />
                            <text x="50" y="-10" text-anchor="middle" font-weight="bold" fill="#334155">RPi GPIO (3.3V)</text>
                            <text x="10" y="30" class="pin-label">3.3V</text>
                            <text x="10" y="380" class="pin-label">GND</text>
                            <text x="90" y="80" text-anchor="end" class="pin-label">RGB Data</text>
                            <text x="90" y="200" text-anchor="end" class="pin-label">Address (A-E)</text>
                            <text x="90" y="320" text-anchor="end" class="pin-label">Ctrl (CLK/LAT)</text>
                        </g>

                        <!-- U1: Data Buffer -->
                        <g transform="translate(300, 50)">
                            <rect width="120" height="100" class="chip" />
                            <text x="60" y="-10" text-anchor="middle" font-weight="bold" fill="#334155">U1: 74AHCT245</text>
                            <text x="60" y="50" text-anchor="middle" font-size="10" fill="#64748b">RGB Data (R1..B2)</text>
                            <line x1="-150" y1="50" x2="0" y2="50" class="wire" stroke-dasharray="4" />
                        </g>

                        <!-- U2: Address Buffer -->
                        <g transform="translate(300, 180)">
                            <rect width="120" height="100" class="chip" />
                            <text x="60" y="-10" text-anchor="middle" font-weight="bold" fill="#334155">U2: 74AHCT245</text>
                            <text x="60" y="50" text-anchor="middle" font-size="10" fill="#64748b">Addr (A,B,C,D,E)</text>
                            <line x1="-150" y1="50" x2="0" y2="50" class="wire" stroke-dasharray="4" />
                        </g>

                        <!-- U3: Control Buffer -->
                        <g transform="translate(300, 310)">
                            <rect width="120" height="100" class="chip" />
                            <text x="60" y="-10" text-anchor="middle" font-weight="bold" fill="#334155">U3: 74AHCT245</text>
                            <text x="60" y="50" text-anchor="middle" font-size="10" fill="#64748b">Ctrl (CLK, LAT, OE)</text>
                            <line x1="-150" y1="50" x2="0" y2="50" class="wire" stroke-dasharray="4" />
                        </g>

                        <!-- HUB75 Output -->
                        <g transform="translate(650, 100)">
                            <rect width="100" height="300" class="chip" />
                            <text x="50" y="-10" text-anchor="middle" font-weight="bold" fill="#334155">HUB75 (5V TTL)</text>
                            <!-- Pins -->
                            <text x="10" y="30" class="pin-label">R1 / G1 / B1</text>
                            <text x="10" y="50" class="pin-label">R2 / G2 / B2</text>
                            <text x="10" y="150" class="pin-label">A / B / C / D / E</text>
                            <text x="10" y="250" class="pin-label">CLK / LAT / OE</text>
                            <text x="10" y="280" class="pin-label" fill="blue">GND</text>
                        </g>

                        <!-- Connecting Wires (3.3V -> 5V Logic) -->
                        <!-- U1 to HUB -->
                        <line x1="420" y1="100" x2="650" y2="130" class="wire" />
                        <text x="535" y="110" font-size="10" fill="#64748b">5V Logic</text>

                        <!-- U2 to HUB -->
                        <line x1="420" y1="230" x2="650" y2="230" class="wire" />

                        <!-- U3 to HUB -->
                        <line x1="420" y1="360" x2="650" y2="330" class="wire" />

                        <!-- Power Rails -->
                        <line x1="360" y1="50" x2="360" y2="20" class="wire pwr" stroke-width="3" /><text x="365" y="15" font-size="12" fill="#ef4444" font-weight="bold">5V</text>
                        <line x1="360" y1="410" x2="360" y2="440" class="wire gnd" stroke-width="3" /><text x="365" y="455" font-size="12" fill="#3b82f6" font-weight="bold">GND</text>
                        
                        <!-- Decoupling Cap Hints -->
                        <circle cx="310" cy="60" r="3" fill="#fbbf24" /><text x="295" y="45" font-size="8" fill="#d97706">0.1uF</text>
                        <circle cx="310" cy="190" r="3" fill="#fbbf24" />
                        <circle cx="310" cy="320" r="3" fill="#fbbf24" />

                    </svg>
                </div>
                <p class="text-sm text-slate-500 mt-2 text-center">* 修正：採用 3 顆 IC 架構，分別處理 Data、Address 與 Control 訊號，降低串擾。</p>
            </section>

            <!-- 3. Pinout -->
            <section id="pinout" class="mb-16">
                <h3 class="text-xl text-sky-400 mb-6 flex items-center gap-2"><span class="text-2xl">03.</span> Pinout 定義</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-slate-900 rounded-lg border border-slate-800 p-4">
                        <h4 class="text-white font-bold mb-4 border-b border-slate-700 pb-2">DATA (U1 負責)</h4>
                        <table class="tech-table">
                            <thead><tr><th>Signal</th><th>RPi GPIO</th><th>Pin #</th></tr></thead>
                            <tbody>
                                <tr><td>R1</td><td>GPIO 5</td><td>29</td></tr>
                                <tr><td>G1</td><td>GPIO 13</td><td>33</td></tr>
                                <tr><td>B1</td><td>GPIO 6</td><td>31</td></tr>
                                <tr><td>R2</td><td>GPIO 12</td><td>32</td></tr>
                                <tr><td>G2</td><td>GPIO 16</td><td>36</td></tr>
                                <tr><td>B2</td><td>GPIO 23</td><td>16</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="bg-slate-900 rounded-lg border border-slate-800 p-4">
                        <h4 class="text-white font-bold mb-4 border-b border-slate-700 pb-2">CTRL (U3 負責)</h4>
                        <table class="tech-table">
                            <thead><tr><th>Signal</th><th>RPi GPIO</th><th>Pin #</th></tr></thead>
                            <tbody>
                                <tr><td>CLK</td><td>GPIO 17</td><td>11</td></tr>
                                <tr><td>LAT</td><td>GPIO 4</td><td>7</td></tr>
                                <tr><td>OE</td><td>GPIO 18</td><td>12</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- 4. Wiring -->
            <section id="wiring" class="mb-16">
                <h3 class="text-xl text-sky-400 mb-6 flex items-center gap-2"><span class="text-2xl">04.</span> 物理佈線</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-slate-800 p-6 rounded-xl border border-slate-700">
                        <h4 class="text-lg font-bold text-amber-400 mb-2">數據：U 型菊花鏈</h4>
                        <div class="font-mono text-xs text-slate-300 bg-black p-4 rounded leading-loose">[RPi] -> [P1] -> [P2] -> [P3]<br>                       |<br>[P6] <- [P5] <- [P4] <-'</div>
                    </div>
                    <div class="bg-slate-800 p-6 rounded-xl border border-slate-700">
                        <h4 class="text-lg font-bold text-red-400 mb-2">電源：星狀並聯</h4>
                        <div class="font-mono text-xs text-slate-300 bg-black p-4 rounded leading-loose">     [PSU]<br>    /  |  \<br>[P1] [P2] [P3] ...</div>
                    </div>
                </div>
            </section>

            <!-- 5. Firmware Code -->
            <section id="firmware" class="mb-16">
                <h3 class="text-xl text-sky-400 mb-6 flex items-center gap-2"><span class="text-2xl">05.</span> 韌體程式碼</h3>
                <pre><code class="language-python rounded-lg shadow-lg text-sm"># ... (Code identical to v5.2, omitted for brevity) ...
options.pixel_mapper_config = "U-mapper;3"
options.gpio_slowdown = 4
</code></pre>
            </section>

            <!-- 6. Checklist -->
            <section id="checklist" class="mb-16">
                <h3 class="text-xl text-sky-400 mb-6 flex items-center gap-2"><span class="text-2xl">06.</span> 工程師檢核</h3>
                <div class="bg-slate-900 border border-slate-800 rounded-lg p-6">
                    <p class="text-sm text-slate-400">⚠️ 確認 RPi GND 與 PSU GND 共地。</p>
                </div>
            </section>
        </div>
    </main>
    <script>
        function scrollToSection(id) { document.getElementById(id).scrollIntoView({ behavior: 'smooth' }); document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active')); event.target.classList.add('active'); }
    </script>
</body>
</html>
